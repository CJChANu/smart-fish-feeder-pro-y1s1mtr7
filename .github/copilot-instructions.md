# Copilot / Agent Instructions for smart_fish_feeder_pro

This project is a small Flutter app controlling an ESP32 fish feeder via Firebase Realtime Database. The goal of this document is to give an AI coding agent the exact, actionable context it needs to be productive here.

## Quick architecture (what to know) üîß
- Flutter frontend only (mobile + desktop targets). Entry point: `lib/main.dart`.
- State/DI: minimal use of Riverpod. The app wraps with `ProviderScope` in `main.dart`.
- Device communication: Firebase Realtime Database is the integration point. See `lib/core/services/firebase_service.dart` for the singleton service.
  - DB structure expected by code: `devices/{deviceId}/status` (realtime values) and `devices/{deviceId}/commands/feedNow` (command toggled true then false).
  - Example usage: `FirebaseService().streamDeviceStatus(deviceId)` and `FirebaseService().sendFeedCommand(deviceId)`.
- UI: features live under `lib/features/*`. Example: dashboard at `lib/features/dashboard/dashboard_screen.dart`.
- Constants: `lib/core/constants/app_constants.dart` stores `deviceId` and `firebaseDbUrl` used across the app.
- Firebase config file generated by FlutterFire CLI: `lib/firebase_options.dart` (committed here).

## Developer workflows & important commands ‚úÖ
- Install deps: `flutter pub get`
- Analyze: `dart analyze` or use IDE's analyzer
- Run app: `flutter run -d <device>` (example: `flutter run -d chrome` or `flutter run -d emulator-5554`)
- Run tests: `flutter test`
- Build release APK: `flutter build apk --release`
- View logs: `flutter logs` or `adb logcat` for Android-specific logs
- If you change Firebase config, regenerate `lib/firebase_options.dart` with FlutterFire CLI: `flutterfire configure` (ensure correct Firebase project).

## Project-specific patterns & conventions üß≠
- Singleton service pattern: `FirebaseService` uses a private constructor and shared instance; prefer adding database helpers here for new DB paths.
- DB interactions are real-time streams (StreamBuilder -> DatabaseEvent). When adding new status items, follow the pattern used in `dashboard_screen.dart`.
- UI sizes use `flutter_screenutil` designSize `375x812` (see `ScreenUtilInit` in `main.dart`); prefer responsive sizing using `.sp`, `.w`, `.h` as seen in the dashboard code.
- Logging: `logger` package is used inside `FirebaseService` ‚Äî keep logs consistent and concise.
- Build files: Android sets `compileSdk=34` and uses the `com.google.gms.google-services` plugin in `android/app/build.gradle.kts` ‚Äî do not remove this when modifying Android build config.
- Release signing: The current `release` build type uses the `debug` signing config so `flutter run --release` works in development. Production signing should be added per normal Android best practices.

## Concrete examples for quick edits ‚úçÔ∏è
- To add a new DB stream to show `pH` value:
  - Add a helper in `FirebaseService`: `Stream<DatabaseEvent> streamPH(String deviceId) => deviceRef(deviceId).child('status/ph').onValue;`
  - Use it in a screen via `StreamBuilder<DatabaseEvent>(stream: FirebaseService().streamPH(deviceId), builder: ...)`.
- To send a new command `commands/resetFeed`:
  - Add `Future<void> resetFeed(String deviceId) => deviceRef(deviceId).child('commands/resetFeed').set(true);`
  - Toggle to false after a short delay if needed (follow `sendFeedCommand` pattern).

## Tests & CI notes ‚ö†Ô∏è
- Only default widget test exists in `test/widget_test.dart`. Prefer adding small widget/unit tests when changing behavior.
- There is no CI config committed. If adding CI, ensure the job runs `flutter pub get`, `dart analyze`, and `flutter test`.

## Security & secrets üõ°Ô∏è
- `lib/firebase_options.dart` is committed and contains Firebase keys generated by FlutterFire. If you need to rotate keys or switch projects, use FlutterFire CLI and follow secure handling for any CI secrets (SERVICE_ACCOUNT credentials or environment variables).

## Files to inspect when making changes üîç
- App entry / global config: `lib/main.dart`
- Firebase integration: `lib/core/services/firebase_service.dart`
- Constants: `lib/core/constants/app_constants.dart`
- Dashboard UI: `lib/features/dashboard/dashboard_screen.dart`
- Firebase config (generated): `lib/firebase_options.dart`
- Android Gradle: `android/app/build.gradle.kts`
- Pubspec / dependencies: `pubspec.yaml`

---
If a section is unclear or you want more detail (CI, signing, hardware device test steps, or expected device-side payload examples), tell me which area to expand and I will iterate. ‚úÖ